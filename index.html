<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寵物品種識別</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #imagePreview {
            max-width: 100%;
            margin-top: 20px;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
            white-space: pre-wrap;
        }
        #loading {
            display: none;
        }
    </style>
</head>
<body>
    <h1>寵物品種識別</h1>
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="uploadImage()">上傳並識別</button>
    <div id="result"></div>
    <img id="uploadedImage" style="max-width: 100%; display: none;">

    <script>
        const corsProxy = 'https://cors-anywhere.herokuapp.com/';
        const apiUrl = corsProxy + 'http://54.254.194.136:183/dog-predict';

        async function uploadImage() {
            const input = document.getElementById('imageInput');
            const resultDiv = document.getElementById('result');
            const uploadedImage = document.getElementById('uploadedImage');

            if (!input.files || input.files.length === 0) {
                resultDiv.innerText = '請選擇一張圖片。';
                return;
            }

            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = async function(e) {
                uploadedImage.src = e.target.result;
                uploadedImage.style.display = 'block';

                resultDiv.innerText = '正在識別中...';

                try {
                    const formData = new FormData();
                    formData.append('file', file);

                    const response = await axios.post(apiUrl, formData, {
                        headers: {
                            'Content-Type': 'multipart/form-data'
                        }
                    });

                    if (response.data && response.data.predicted_breed) {
                        resultDiv.innerText = `識別結果：${response.data.predicted_breed}`;
                    } else {
                        resultDiv.innerText = '無法識別品種，請再試一次。';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    resultDiv.innerText = '識別過程中發生錯誤，請稍後再試。';
                }
            };

            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
